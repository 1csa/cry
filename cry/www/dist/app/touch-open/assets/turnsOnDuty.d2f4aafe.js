import{d as Y,ae as W,G as z,l as L,c as Z,af as ee,r,o,a as u,F as m,B as y,f as v,w as a,i as w,t as b,h as A,e as x,b as l,ag as te,ah as oe,ai as ae,y as se,z as le,H as ne,aj as ie,p as ue,ak as de,a5 as U,al as re,X as ce,J as _e,am as pe,j as I,E as me,an as fe,ao as ye,k as be}from"./index.2bba2224.js";const ve=Y({__name:"StaffTags",props:{employeeOptions:null,employeeList:null,shopId:null,date:null,jobData:null},emits:["add","remove"],setup(h,{emit:D}){const C=h,{employeeList:V,jobData:j,date:B,shopId:R}=W(C),S=z(),F=z([]);F.value=C.employeeList;const s=L({selectVisible:!1,selectValue:void 0}),g=Z(()=>V.value.length),n=()=>{s.selectVisible=!0,oe(()=>{S.value.focus()})},O=async d=>{await f(d.employee_id,2),D("remove")},E=async()=>{if(s.selectValue){const d=s.selectValue.option,_=C.employeeList.some(p=>d.employee_id===p.employee_id);if(d.employee_id&&!_)try{await f(d.employee_id,1),D("add")}catch(p){console.log(p)}}Object.assign(s,{selectVisible:!1,selectValue:void 0})},f=async(d,_)=>{let p={job_id:j.value.job_id,date:B.value,shop_id:R==null?void 0:R.value,employee_id:d,op_type:_};return await ae(p)};return ee(()=>C.employeeList,(d,_)=>{F.value=d}),(d,_)=>{const p=r("a-tag"),T=r("a-select");return o(),u("div",null,[(o(!0),u(m,null,y(F.value,(t,i)=>(o(),v(p,{key:i,closable:"",onClose:k=>O(t)},{default:a(()=>[w(b(t.name),1)]),_:2},1032,["onClose"]))),128)),s.selectVisible?(o(),v(T,{key:0,ref_key:"selectRef",ref:S,size:"small",style:{"min-width":"80px"},"label-in-value":"",value:s.selectValue,"onUpdate:value":_[0]||(_[0]=t=>s.selectValue=t),options:h.employeeOptions,fieldNames:{label:"name",value:"employee_id"},onBlur:E},null,8,["value","options"])):A("",!0),!s.selectVisible&&x(g)<x(j).job_count?(o(),v(p,{key:1,style:{background:"#fff","border-style":"dashed"},onClick:n},{default:a(()=>[l(x(te))]),_:1})):A("",!0)])}}}),he=h=>(fe("data-v-bfb74643"),h=h(),ye(),h),je=w("\u67E5\u770B"),ge=w("\u65B0\u589E\u89D2\u8272"),ke=w("\u5220\u9664\u89D2\u8272"),we=he(()=>I("div",{class:"rotation-header"},"\u89D2\u8272",-1)),Ce={class:"rotation-ul"},Le={key:0},xe={class:"rotation-header"},De={class:"rotation-ul"},Fe={name:"ShopTurnsOnDuty"},Ie=Y({...Fe,setup(h){L({labelCol:{span:4},wrapperCol:{span:14}});const D="YYYY-MM-DD",C=se.useForm,V=ie(),{modelRef:j,rulesRef:B}=le(V),{resetFields:R,validate:S,validateInfos:F}=C(j,B),s=L({shopId:null,jobList:[],employeeList:[]}),g=L({job_list:[],rotation:{},rotationList:{}}),n=L({visible:!1,type:"",value:void 0});L({display:"flex",height:"30px",lineHeight:"30px"});const O=async()=>{const t=await re();s.jobList=t.result},E=async()=>{const t=await ce({shop_id:s.shopId,page:1,status:1,page_size:100}),{list:i}=t.result;s.employeeList=i.map(k=>({employee_id:k.id,name:k.name}))},f=async()=>{await S();const t=_e.exports.cloneDeep(j);t.start_time=t.time&&t.time[0].format(D),t.end_time=t.time&&t.time[1].format(D),t.shop_id=s.shopId,delete t.time;const{result:i}=await pe(t);Object.assign(g,i)},d=t=>{s.shopId=t,T()},_=t=>{n.type=t,n.visible=!0},p=async()=>{if(!n.value)return ue.error("\u8BF7\u9009\u62E9\u89D2\u8272\uFF01");let t={shop_id:s.shopId,job_id:Math.floor(n.value),op_type:n.type==="add"?1:2};await de(t),Object.assign(n,{visible:!1,type:"",value:void 0}),await f()},T=async()=>{j.time=[U(),U().add(15,"day")],await O(),await E(),await f()};return(t,i)=>{const k=r("a-button"),G=r("a-space"),H=r("a-form-item"),P=r("a-form"),J=r("a-card"),M=r("a-col"),X=r("a-row"),$=r("a-radio"),q=r("a-radio-group"),K=r("a-modal");return o(),u("div",null,[l(ne,{fixed:!0,onChange:d},{search:a(()=>[l(J,{class:"search-box"},{default:a(()=>[l(P,{ref:"searchFormRef",layout:"inline"},{default:a(()=>[(o(!0),u(m,null,y(x(V),(e,c)=>(o(),v(me,{key:c,field:e,modelRef:x(j),fieldkey:c,validateInfos:x(F)},null,8,["field","modelRef","fieldkey","validateInfos"]))),128)),l(H,null,{default:a(()=>[l(G,{size:20},{default:a(()=>[l(k,{type:"primary",onClick:f},{default:a(()=>[je]),_:1}),l(k,{type:"primary",onClick:i[0]||(i[0]=e=>_("add"))},{default:a(()=>[ge]),_:1}),l(k,{type:"danger",onClick:i[1]||(i[1]=e=>_("del"))},{default:a(()=>[ke]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),main:a(()=>[l(J,{class:"table-box mt20"},{default:a(()=>[l(X,{class:"rotation"},{default:a(()=>[l(M,{class:"rotation-col"},{default:a(()=>[we,I("ul",Ce,[(o(!0),u(m,null,y(g.job_list,(e,c)=>(o(),u("li",{key:e.job_id,class:"rotation-li"},[w(b(e.job_name),1),e.job_count>1?(o(),u("span",Le,"("+b(e.job_count)+")",1)):A("",!0)]))),128))])]),_:1}),(o(!0),u(m,null,y(g.rotation,(e,c)=>(o(),v(M,{key:c,class:"rotation-col"},{default:a(()=>[I("div",xe,b(c.toString().split("-")[1]+"."+c.toString().split("-")[2]),1),I("ul",De,[(o(!0),u(m,null,y(e,(N,Q)=>(o(),u("li",{key:N.employee_id,class:"rotation-li"},[l(ve,{"employee-options":s.employeeList,"employee-list":N,date:c,"shop-id":s.shopId,"job-data":g.job_list[Q],onAdd:f,onRemove:f},null,8,["employee-options","employee-list","date","shop-id","job-data"])]))),128))])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),l(K,{visible:n.visible,"onUpdate:visible":i[3]||(i[3]=e=>n.visible=e),title:`${n.type==="add"?"\u6DFB\u52A0":"\u5220\u9664"}\u89D2\u8272`,maskClosable:!1,onOk:p,width:"40%"},{default:a(()=>[l(q,{value:n.value,"onUpdate:value":i[2]||(i[2]=e=>n.value=e)},{default:a(()=>[n.type==="add"?(o(!0),u(m,{key:0},y(s.jobList,e=>(o(),v($,{value:e.job_id,key:e.job_id},{default:a(()=>[w(b(e.name),1)]),_:2},1032,["value"]))),128)):(o(!0),u(m,{key:1},y(g.job_list,e=>(o(),u(m,{key:e.job_id},[e.job_count<=1?(o(),v($,{key:0,value:e.job_id+e.job_count/10},{default:a(()=>[w(b(e.job_name),1)]),_:2},1032,["value"])):(o(!0),u(m,{key:1},y(e.job_count,c=>(o(),v($,{value:e.job_id+c/10},{default:a(()=>[I("span",null,b(e.job_name)+"("+b(c)+")",1)]),_:2},1032,["value"]))),256))],64))),128))]),_:1},8,["value"])]),_:1},8,["visible","title"])])}}});const Re=be(Ie,[["__scopeId","data-v-bfb74643"]]);export{Re as default};
